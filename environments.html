

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>environments package &mdash; Neurotrack 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=d45e8c67"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Neurotrack
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Neurotrack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">environments package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/environments.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="environments-package">
<h1>environments package<a class="headerlink" href="#environments-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-environments.env_utils">
<span id="environments-env-utils-module"></span><h2>environments.env_utils module<a class="headerlink" href="#module-environments.env_utils" title="Link to this heading"></a></h2>
<p>Environment helper functions</p>
<p>Author: Bryson Gray
2024</p>
<dl class="py function">
<dt class="sig sig-object py" id="environments.env_utils.binary_matching_error">
<span class="sig-prename descclassname"><span class="pre">environments.env_utils.</span></span><span class="sig-name descname"><span class="pre">binary_matching_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_patch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_patch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">true_patch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#environments.env_utils.binary_matching_error" title="Link to this definition"></a></dt>
<dd><p>Calculate the precision of the new estimate.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new_patch</strong> (<em>torch.Tensor</em>) – The new patch tensor to be evaluated.</p></li>
<li><p><strong>old_patch</strong> (<em>torch.Tensor</em>) – The old patch tensor for comparison.</p></li>
<li><p><strong>true_patch</strong> (<em>torch.Tensor</em>) – The ground truth patch tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The precision of the new patch, calculated as TP / (TP + FP), where TP is the number of true positive pixels
and FP is the number of false positive pixels.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="environments.env_utils.density_error_change">
<span class="sig-prename descclassname"><span class="pre">environments.env_utils.</span></span><span class="sig-name descname"><span class="pre">density_error_change</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">true_density</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_density</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_density</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#environments.env_utils.density_error_change" title="Link to this definition"></a></dt>
<dd><p>Change in the error between true and estimated density maps. Error is the sum of square difference between density maps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>true_density</strong> (<em>torch.Tensor</em>)</p></li>
<li><p><strong>old_density</strong> (<em>torch.Tensor</em>)</p></li>
<li><p><strong>new_density</strong> (<em>torch.Tensor</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The change in sum of square errors between the old and new density maps.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="environments.env_utils.plot_durations">
<span class="sig-prename descclassname"><span class="pre">environments.env_utils.</span></span><span class="sig-name descname"><span class="pre">plot_durations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">episode_durations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_result</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#environments.env_utils.plot_durations" title="Link to this definition"></a></dt>
<dd><p>Plots the durations of episodes and optionally shows the result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>episode_durations</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>float</em>) – A list containing the durations of each episode.</p></li>
<li><p><strong>show_result</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, the plot will display the final result. If False, the plot will display the training progress (default is False).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The function will plot the episode durations and, if there are at least 100 episodes, it will also plot the 100-episode moving average.</p></li>
<li><p>The plot will be updated in real-time during training if <cite>show_result</cite> is False.</p></li>
<li><p>The <cite>display</cite> module from IPython is used to update the plot in real-time.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="environments.env_utils.plot_returns">
<span class="sig-prename descclassname"><span class="pre">environments.env_utils.</span></span><span class="sig-name descname"><span class="pre">plot_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">episode_returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_result</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#environments.env_utils.plot_returns" title="Link to this definition"></a></dt>
<dd><p>Plots the returns of episodes and optionally shows the result.
:param episode_returns: A list or array of episode returns to be plotted.
:type episode_returns: list or array-like
:param show_result: If True, the plot will display the final result. If False, the plot will display the training progress (default is False).
:type show_result: bool, optional</p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The function plots the episode returns and, if the length of <cite>episode_returns</cite> is 100 or more, it also plots the 100-episode moving average.</p></li>
<li><p>The plot is updated in real-time with a short pause to ensure the plot is rendered.</p></li>
<li><p>When <cite>show_result</cite> is False, the plot is cleared and updated continuously to show training progress.</p></li>
<li><p>When <cite>show_result</cite> is True, the plot displays the final result.</p></li>
</ul>
</dd></dl>

</section>
<section id="module-environments.sac_tracking_env">
<span id="environments-sac-tracking-env-module"></span><h2>environments.sac_tracking_env module<a class="headerlink" href="#module-environments.sac_tracking_env" title="Link to this heading"></a></h2>
<p>Soft actor critic reinforcement learning tractography environment</p>
<p>Author: Bryson Gray
2024</p>
<dl class="py class">
<dt class="sig sig-object py" id="environments.sac_tracking_env.Environment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">environments.sac_tracking_env.</span></span><span class="sig-name descname"><span class="pre">Environment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">friction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">classifier</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#environments.sac_tracking_env.Environment" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class represents the environment for soft actor critic (SAC) reinforcement learning applied to tracing antomical structures.
It provides methods to initialize the environment, take steps, compute rewards, and reset the environment.</p>
<dl class="py method">
<dt class="sig sig-object py" id="environments.sac_tracking_env.Environment.get_reward">
<span class="sig-name descname"><span class="pre">get_reward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">category</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'step'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'out_of_image'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'out_of_mask'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'too_long'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'choose_stop'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'bifurcate'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_accuracy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="headerlink" href="#environments.sac_tracking_env.Environment.get_reward" title="Link to this definition"></a></dt>
<dd><p>Calculate the reward based on the given category and step accuracy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>category</strong> (<em>Literal</em><em>[</em><em>&quot;step&quot;</em><em>, </em><em>&quot;out_of_image&quot;</em><em>, </em><em>&quot;out_of_mask&quot;</em><em>, </em><em>&quot;too_long&quot;</em><em>, </em><em>&quot;choose_stop&quot;</em><em>, </em><em>&quot;bifurcate&quot;</em><em>]</em>) – The category of the action taken.</p></li>
<li><p><strong>step_accuracy</strong> (<em>float</em><em>, </em><em>optional</em>) – The accuracy of the step taken, by default 0.0.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, prints detailed information about the reward calculation, by default False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The calculated reward as a tensor.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>NameError</strong> – If the provided category is not recognized.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="environments.sac_tracking_env.Environment.get_state">
<span class="sig-name descname"><span class="pre">get_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">terminate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#environments.sac_tracking_env.Environment.get_state" title="Link to this definition"></a></dt>
<dd><p>Get the state for the current step at streamline ‘head_id’. The state consists of an image patch and
streamline density patch centered on the streamline head.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>terminate</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, returns a zero tensor representing the terminated state. If False, returns the current state.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>patch</strong> – Tensor with shape (c x h x w x d) where the first channels are the input image.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="environments.sac_tracking_env.Environment.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">move_to_next</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#environments.sac_tracking_env.Environment.reset" title="Link to this definition"></a></dt>
<dd><p>Resets the environment state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>move_to_next</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, move to the next image or seed and reset the path. Default is True.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="environments.sac_tracking_env.Environment.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_paths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#environments.sac_tracking_env.Environment.step" title="Link to this definition"></a></dt>
<dd><p>Perform a single step in the environment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action</strong> (<em>torch.Tensor</em>) – The action to be taken, representing the direction of movement.</p></li>
<li><p><strong>max_paths</strong> (<em>int</em><em>, </em><em>optional</em>) – The maximum number of paths allowed, by default 100. Not currently implemented.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, additional information will be printed, by default False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>observation</strong> (<em>torch.Tensor</em>) – The current state of the environment after the step.</p></li>
<li><p><strong>reward</strong> (<em>float</em>) – The reward obtained from taking the step.</p></li>
<li><p><strong>terminated</strong> (<em>bool</em>) – Whether the episode has terminated.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-environments">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-environments" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Bryson Gray, Daniel Tward.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>